# Проверка работоспособности RAG-пайплайна на тестовых данных

## Набор данных
Использован предоставленный список работ (19 записей) с полями «Работа», «Пункт ремонтной ведомости» и «Описание». Данные приведены к формату JSONL в файле `examples/test_tasks.jsonl`.

## Окружение
- Python 3.11 в виртуальном окружении `.venv`
- Установлены пакеты: `torch 2.3.1+cpu`, `transformers 4.57.0`, `chromadb 0.4.24` и связанные зависимости
- Для эмбеддингов используется модель `BAAI/bge-small-en-v1.5`, загружаемая через `transformers`

## Шаги воспроизведения
1. **Индексация**
   ```bash
   python rag_index.py examples/test_tasks.jsonl --collection test_tasks --reset
   ```
   - Загружено 19 документов, разбито на 19 чанков
   - Эмбеддинги рассчитаны через `HuggingFaceEncoder`
   - Коллекция `test_tasks` сохранена в `chroma_db/`

2. **Проверка поиска**
   ```bash
   python rag_query_simple.py --collection test_tasks --top-k 3
   ```
   Примеры запросов:
   - «Какая работа предусматривает подключение пожарной магистрали?»
   - «Какие работы связаны со швартовыми операциями?»
   - «Что требуется для обеспечения судна электропитанием?»
   - «Какая работа отвечает за швартовые операции, включая буксиры и лоцманов?»

## Журнал проверки от 6 октября 2025

- Индексация прошла успешно: 19 документов обработаны, Chroma-папка пересоздана с нуля.
- При запросах с уникальными формулировками («подключение пожарной магистрали», «швартовые операции, включая буксиры и лоцманов») система возвращает корректные документы в топе.
- Для более общих вопросов («Какие работы связаны со швартовыми операциями?», «Что требуется для обеспечения судна электропитанием?») наблюдается смешение релевантных и нерелевантных ответов. Это объясняется короткими описаниями и пересечением терминов внутри датасета.
- Сырые логи CLI (см. ниже) включают расстояния между запросом и документами, что помогает быстро оценить уверенность системы.

### Фрагменты CLI-сессий

```text
$ python rag_query_simple.py --collection test_tasks --top-k 3
Вопрос: Какая работа предусматривает подключение пожарной магистрали?
...
Источник 1: 000127 / Пожарная безопасность ... (distance ≈ 0.39)
```

```text
$ python rag_query_simple.py --collection test_tasks --top-k 3
Вопрос: Какая работа отвечает за швартовые операции, включая буксиры и лоцманов?
...
Источник 1: Буксиры мощностью 2500 л/с ... (distance ≈ 0.47)
```

Для вопросов с более широкой формулировкой рекомендуется уточнять ключевые признаки (например, добавлять «буксиры», «электропитание 3 х 380 В»), чтобы повысить релевантность выдачи.

## Наблюдения
- Телеметрия `chromadb` пытается отправить события и логирует ошибки `capture() takes 1 positional argument but 3 were given`. Это не влияет на пайплайн, но при необходимости можно отключить телеметрию (например, переменной окружения `ANONYMIZED_TELEMETRY=0`).
- Модель `BAAI/bge-small-en-v1.5` чувствительна к формулировкам: для более точных ответов рекомендовано дополнять запросы ключевыми словами из описаний.

## Выводы
- Индексация и поиск по предоставленному списку работ успешно выполняются.
- Пайплайн готов к обработке большего набора данных при наличии достаточных ресурсов.
